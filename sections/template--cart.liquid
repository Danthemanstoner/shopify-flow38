{% comment %}
  Enhanced cart template to display discounts and additional product details.
{% endcomment %}

<div class="wrapper-padded main-page-container">
  {% assign subtotal_compare_at_price = 0 %}

  {% if cart.item_count > 0 %}
    <div class="sitewide--title-wrapper">
      <h1 class="page--title">{{ 'cart.general.title' | t }}</h1>
    </div>

    <form action="{{ routes.cart_url }}" method="post" novalidate class="cart table-wrap" data-wetheme-section-type="template--cart" data-wetheme-section-id="template--cart">
      <table class="cart-table full table--responsive">
        <thead class="cart__row cart__header-labels">
          <th scope="row" colspan="2" class="text-center">Product</th>
          <th scope="row" class="text-center">Price</th>
          <th scope="row" class="text-center">Quantity</th>
          <th scope="row" class="text-center">Total</th>
        </thead>
        <tbody>
          {% for item in cart.items %}
            <tr class="cart__row table__section">
              <td class="cart__image">
                <a href="{{ item.url }}">
                  {% render 'responsive-image', image: item.image, max_width: 300, max_height: 300, class: 'product-thumbnail' %}
                </a>
              </td>
              <td class="cart__row--product-details">
                <a href="{{ item.url }}">
                  {{ item.product.title }}
                </a>
                {% if item.variant.title != 'Default Title' %}
                  <div class="cart__meta-text">
                    Variant: {{ item.variant.title }}
                  </div>
                {% endif %}
                {% render 'product-custom-properties', properties: item.properties %}
              </td>
              <td class="text-center" data-label="Price">
                {% if item.original_price > item.final_price %}
                  <div class="price-original">{{ item.original_price | money }}</div>
                  <div class="price-sale">{{ item.final_price | money }}</div>
                  <!-- Display the discount amount for the line item -->
                  <div class="discount-amount">You save: {{ item.original_price | minus: item.final_price | money }}</div>
                {% else %}
                  <div class="price">{{ item.final_price | money }}</div>
                {% endif %}
              </td>
              <td class="text-center" data-label="Quantity">
                <input type="number" min="1" value="{{ item.quantity }}" name="updates[]" id="updates_{{ item.key }}" class="quantity-input">
              </td>
              <td class="text-center" data-label="Total">
                <div class="line-total">{{ item.line_price | money }}</div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- Display any cart-level discounts here -->
      {% if cart.cart_level_discount_applications.size > 0 %}
        <div class="cart-discounts">
          <h3>Applied Discounts</h3>
          {% for discount in cart.cart_level_discount_applications %}
            <div class="cart-discount">
              {{ discount.title }}: -{{ discount.total_allocated_amount | money }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
      <div class="cart-footer">
        <div class="cart-subtotal">
          Subtotal: <span class="subtotal">{{ cart.total_price | money }}</span>
        </div>
        <button type="submit" name="checkout" class="btn btn-primary">Checkout</button>
      </div>
    </form>
  {% else %}
    <div class="empty-cart">
      <h2>Your cart is empty</h2>
      <a href="/collections/all" class="btn btn-secondary">Continue Shopping</a>
    </div>
  {% endif %}
</div>
