{% comment %}
  Enhanced cart template to display discounts and additional product details.
{% endcomment %}

<div class="wrapper-padded main-page-container">
  {% assign subtotal_compare_at_price = 0 %}

  {% if cart.item_count > 0 %}
    <div class="sitewide--title-wrapper">
      <h1 class="page--title">{{ 'cart.general.title' | t }}</h1>
    </div>

    <form action="{{ routes.cart_url }}" method="post" novalidate class="cart table-wrap" data-wetheme-section-type="template--cart" data-wetheme-section-id="template--cart">
      <table class="cart-table full table--responsive">
        <thead class="cart__row cart__header-labels">
          <th scope="row" colspan="2" class="text-center"></th>
          <th scope="row" class="text-center">{{ 'cart.label.price' | t }}</th>
          <th scope="row" class="text-center">{{ 'cart.label.quantity' | t }}</th>
          <th scope="row" class="text-center">{{ 'cart.label.total' | t }}</th>
        </thead>
        <tbody>
          {% for item in cart.items %}
            <tr class="cart__row table__section">
              <td data-label="{{ 'customer.order.product' | t }}">
                <a href="{{ item.url | within: collections.all }}" class="cart__image">
                  {% capture cart_page_product_image_alt %}{{ item.image.alt | default: item.title | escape }}{% endcapture %}
                  {% render 'responsive-image' with item.image, alt: cart_page_product_image_alt, blur: false %}
                </a>
              </td>
              <td class="cart__row--product-details">
                <a class="cart__row--title" href="{{ item.url }}">
                  {{ item.product.title }}
                </a>
                {% unless item.variant.title contains 'Default' %}
                  <div class="cart__meta-text">
                    {% for option in item.product.options %}
                      {{ option }}: {{ item.variant.options[forloop.index0] }}<br/>
                    {% endfor %}
                  </div>
                {% endunless %}
              </td>
              <td class="text-center" data-label="{{ 'cart.label.price' | t }}">
                {%- if item.original_price > item.final_price -%}
                  <div class="price-original">{{ item.original_price | money }}</div>
                  <div class="price-sale">{{ item.final_price | money }}</div>
                  <div class="discount-amount">You save: {{ item.original_price | minus: item.final_price | money }}</div>
                {%- else -%}
                  <div class="price">{{ item.final_price | money }}</div>
                {%- endif -%}
              </td>
              <td class="text-center" data-label="{{ 'cart.label.quantity' | t }}">
                <input type="number" min="1" value="{{ item.quantity }}" name="updates[]" id="updates_{{ item.key }}" class="quantity-input">
              </td>
              <td class="text-center" data-label="{{ 'cart.label.total' | t }}">
                <div class="line-total">{{ item.line_price | money }}</div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if cart.cart_level_discount_applications.size > 0 %}
        <div class="cart-discounts">
          <h3>Applied Discounts:</h3>
          {% for discount in cart.cart_level_discount_applications %}
            <div class="cart-discount">
              {{ discount.title }}: -{{ discount.total_allocated_amount | money_with_currency }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
      <div class="cart-footer">
        <div class="cart-subtotal">
          Subtotal: <span class="subtotal">{{ cart.total_price | money_with_currency }}</span>
        </div>
        <button type="submit" name="checkout" class="btn btn-primary">Checkout</button>
      </div>
    </form>
  {% else %}
    <div class="empty-cart">
      <h2>Your cart is empty</h2>
      <a href="{{ routes.all_products_collection_url }}" class="btn btn-secondary">Continue Shopping</a>
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "t:sections.template--cart.name"
}
{% endschema %}
